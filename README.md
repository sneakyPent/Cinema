# Cinema

## PROJECT INFO

Στο δικό μου σενάριο εφαρμογής υπάρχει μόνο ένας admin, πολλά members και πολλοί owners. Επίσης, η επικοινωνία με τον
keyrock και όλες οι λειτουργίες του γίνονται μέσω api αποκλειστικά.

Η ανάπτυξη της εφαρμογής έχει γίνει με δυναμικό frontend μέσω vue js και axios (αντί για ajax) και python με django
framework για backend. Τα components του frontend που θα θελήσετε να δείτε βρίσκονται στα path
'frontend/src/components','frontend/src/router', 'frontend/src/views'. Το services έχουν συνδεθεί στο docker-compose.yml
file όπως μας έχει δοθεί στο σχήμα της εκφώνησης.

## FRAMEWORKS

#### BACKEND

* ***Django python***

#### FRONTEND

* ***Vue js***
* ***Material Design Bootstrap***

## PRODUCTION και GCP migration

Για να μπορώ να ανεβάσω το project μου σαν production στο gcp χρειάστηκε να δημιουργήσω το index.html της vue. Για να γίνει αυτό έτρεξα npm run build και πήρα το dist directory στο οποίο περιέχεται ότι χρειάζεται για να χρησιμοποιήσω με το nginx. Για το production λοιπόν χρησιμοποίησα nginx και το confuguration file του βρίσκεται στο frontend directory. Το nginx κάνει listen στο 0.0.0.0 και port 80. Για το gcp λοιπόν αυτό που χρειάστηκε να κάνω είναι να κάνω ένα new vm instance στο Compute Engine με ubunty lts 16.04. Στην συνέχεια, συνδέθηκα με ssh, έκανα upload τα files μου και έκανα install το docker και το docker-compose. Τέλος, έκανα docker-compose up --build με το docker-compose.yml file μου. Για να μπορω να δέχομαι request στο vm έκανα enable το Allow HTTP traffic στο firewall, ανοίγοντας έτσι μόνο την port 80, αφήνοντας το nginx να κάνει την επικοινωνία με τα υπόλοιπα endpoints.

## ORION

Για τον orion δημιουργώ entity σε κάθε δημιουργία ταινίας με attribute availability. Παρακάτω γίνεται περαιτέρω ανάλυση.

## COMPONENTS

Μια σύντομη αναφορά στα κυριότερα βάσει των ζητουμένων.

### ./views/Auth/Login.vue

Είναι η πρώτη σελίδα που εμφανίζεται, εκεί γίνεται η είσοδος του χρήστη με τα credentials που δίνονται παρακάτω. Η
είσοδος γίνεται μέσω του keyrkock με oauth2 στην εγγεγραμμένη εφαρμογή μου, γίνεται έλεγχος ρόλου του χρήστη που
επιστρέφει ο keyrock και γίνεται φόρτωση του κατάλληλου router js απο το
'frontend/src/router'

### ./views/Auth/Register.vue

Στο κάτω μέρος του Login card βρίσκεται ένας σύνδεσμος ('Εγγραφή') για να οδηγηθεί ο χρήστης στη σελίδα της νέας
εγγραφής. Κατά την επιβεβαίωση ή ακύρωση της εγγραφής ο χρήστης οδηγείται και πάλι στο Login page. Επειδή, δεν υπάρχει
sign_up api endpoint στον keyrock, έγινε το εξής workaround. Κατά την επιβεβαίωση του registration απο το Register.vue
δημιουργείται ένα προσωρινό αίτημα δημιουργίας χρήστη στην django στην οντότητα Request, χωρίς να έχει δημιουργηθεί
ακόμα κανένας χρήστης στη βάση του keyrock. Το αίτημα αυτό περιέχει UserName, email, role, cinemaName (αν υπάρχει),
password. Τα αιτήματα αυτά διαχειρίζονται απο τον admin στο Administrator.vue.

### ./views/Home/welcome.vue

Είναι η πρώτη σελίδα που θα δεί ένας χρήστης κατά την είσοδό του. Εκεί θα δούμε οτι υπάρχει ένα sideNav το οποίο
περιέχει στο πάνω μέρος την εικόνα του χρήστη το UserName του, τον Ρόλο του και ένα καμπανάκι για τις ειδοποιήσεις, αν ο
χρήστης είναι member. Οι ειδοποιήσεις λειτουργούν με interval και όταν έρθει νέα ειδοποίηση εμφανίζεται ένας αριθμός με
το πλήθος των καινούργιων ειδοποιήσεων που έχει ο χρήστης, σαν badge πάνω δεξιά απο το καμπανάκι. Απο κάτω υπάρχουν τα
redirecting tabs τα οποία είναι διαφορετικά για κάθε χρήστη, ανάλογα τον ρόλο του.

### ./views/Admin/Administration.vue

Η σελίδα στην οποία μπαίνει μόνο ο admin και απο εκεί μπορεί να διαγράψει ένα αίτημα χρήστη ή να δημιουργήσει τον χρήστη
στη βάση του keyrock. H δυνατότητα να τον ενεργοποιήσει/απενεργοποιήσει δεν υπάρχει πλέον, διότι ο keyrock δεν επιτρέπει
την αλλαγή του 'enabled' μέσω api. Συνεπώς, η 'ενεργοποίηση' είναι η δημιουργία χρήστη και η 'απενεργοποίηση' του είναι
η διαγραφή του. Επιπλέον, όταν γίνεται διαγραφή του χρήστη, διαγράφονται και όλα τα δεδομένα που σχετίζονται με εκείνον
απο όλες τις βάσεις (mySQL, mongoDB (data_storage), mongoDB (orionCB)). Όταν γίνεται αλλαγή ρόλου ενός owner σε user
τότε αυτομάτως διαγράφονται και οι ταινίες και το σινεμά αυτού του χρήστη απο τη βάση δεδομένων. Αντίστοιχα όταν ένας
user γίνεται owner ζητείται να γίνει εισαγωγή του ονόματος του cinema για να γίνει και η αντίστοιχη δημιουργία στη βάση.

### ./views/Owner/Owner.vue

Η σελίδα διαχείρισης των ταινιών ενός owner, απο εκεί διαγράφει, προσθέτει και αλλάζει στοιχεία των υπαρχόντων ταινιών
του. Κατά τη δημιουργία της ταινίας η django στέλνει request στον orion για δημιουργία entity (ταινία) και subscription
πάνω στο attribute availability, αυτό μπορείτε να το δείτε στο αρχείο backend/viewsets.py (lines 77-115). Επίσης, δίπλα
απο κάθε ταινία υπάρχει ένα κουμπί στο column 'Διαθεσιμότητα' του πίνακα, το οποίο όταν εκείνος το πατάει ειδοποιούνται
οι εγγεγραμμένοι χρήστης για την κατάσταση της ταινίας.

### ./views/User/Movies.vue

Σε αυτή τη σελίδα έχουν πρόσβαση όλοι τα 'members' στην οποία βλέπουν όλες τις καταχωρημένες, στη βάση, ταινίες. Έχουν
τη δυνατότητα να φιλτράρουν αυτές που εμφανίζονται σύμφωνα με τον τίτλο, την κατηγορία, τον κινηματογράφο και την
ημερομηνία προβολής. Τα φίλτρα αυτά μπορούν να εφαρμοστούν ταυτόχρονα. Επιπλέον, στο αριστερό μέρος του πίνακα
εμφανίζεται ένα κουμπί σε σχήμα αστεριού το οποίο όταν η ταινία βρίσκεται στα αγαπημένα είναι κίτρινο, διαφορετικά είναι
άσπρο. Το κουμπί είναι clickable και κατά το πάτημα γίνεται η αντίστοιχη διαδικασία, αφαίρεση ή προσθήκη στα αγαπημένα.
Αντίστοιχα, λειτουργεί και το δεύτερο κουμπί (καμπανάκι) για να κάνει subscription ο χρήστης σε μία ταινία, έτσι ώστε να
λαμβάνει τις ειδοποιήσεις που στέλνει ο owner σχετικά με τη διαθεσιμότητα των ταινιών.

### ./views/User/Favorites.vue

Τέλος, έχουμε τη σελίδα των αγαπημένων ταινιών του κάθε χρήστη, που φαίνονται όλες οι ταινίες που έχει προσθέσει σε αυτή
την κατηγορία. Απο εκεί μπορεί μόνο να δει τις ταινίες σε μορφή πίνακα και να αφαιρέσει όσες και όποιες εκείνος
επιθυμεί.

### ./components/Structure/Table.vue

Περιέχει ένα customizable πίνακα που υλοποίησα, και παίρνει σαν props τα φίλτρα, τα κουμπιά που θέλουμε σε κάθε row, τα
κουμπιά που φαίνονται στο table header, τα δεδομένα του πίνακα που θέλουμε να προβάλουμε, καθώς επίσης και αν η κάθε
σειρά του πίνακα θα είναι clickable.

## PROJECT SETUP

```bash
docker-compose up --build
```

## USEFUL URLS

| URL      | INFO
| :------------- |:-------------
| http://localhost/                 | Application
| http://localhost:3005/            | Keyrock Dashboard (Δεν χρειάζεται για τις δοκιμές, όλα γίνονται απο το app)
| http://localhost:8081/            | Mongo Express για τη βάση του Data Storage
| http://localhost:8082/            | Mongo Express για τη βάση του Orion Context Broker
| http://localhost:8083/            | phpMyAdmin για τη βάση του keyrock (u:root p:idm)
| http://localhost:8000/api/        | τα Api endpoints του backend μου

Τα endpoints στο http://localhost:8000/api/ είναι μόνο για να τα δείτε, αν προσπαθήσετε να ανοίξετε κάποιο απο αυτά,
θα έχετε non Authorized, διότι χρειάζεται bearer authorization που γίνεται validation απο τον keyrock.

## CREDENTIALS

| USERNAME          | PASSWORD      |  ROLE
| :-------------    |:------------- |:-------------
| user1@test.com    | mousakas      | Member
| user2@test.com    | mousakas      | Member
| owner1@test.com   | mousakas      | Owner
| owner2@test.com   | mousakas      | Owner
| admin@test.com    | mousakas      | Admin
